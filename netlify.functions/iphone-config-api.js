exports.handler = async (event, context) => {
      const headers = {
          'Access-Control-Allow-Origin': '*',
              'Access-Control-Allow-Headers': 'Content-Type',
                  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',
                      'Content-Type': 'application/json'
                        };

                          if (event.httpMethod === 'OPTIONS') {
                              return { statusCode: 200, headers, body: '' };

                                  try {
                                      const body = JSON.parse(event.body || '{}');
                                          
                                              // Presets de iPhone
                                                  const iPhonePresets = {
                                                        iphone14: {
                                                                model: 'iPhone 14 Pro Max',
                                                                        geral: 95,
                                                                                mira: 88,
                                                                                        redDot: 92,
                                                                                                scope2x: 85,
                                                                                                        scope4x: 78,
                                                                                                                scope8x: 70
                                                                                                                      },
                                                                                                                            iphone13: {
                                                                                                                                    model: 'iPhone 13 Pro',
                                                                                                                                            geral: 90,
                                                                                                                                                    mira: 83,
                                                                                                                                                            redDot: 87,
                                                                                                                                                                    scope2x: 80,
                                                                                                                                                                            scope4x: 75,
                                                                                                                                                                                    scope8x: 65
                                                                                                                                                                                          },
                                                                                                                                                                                                iphone12: {
                                                                                                                                                                                                        model: 'iPhone 12 Pro',
                                                                                                                                                                                                                geral: 85,
                                                                                                                                                                                                                        mira: 78,
                                                                                                                                                                                                                                redDot: 82,
                                                                                                                                                                                                                                        scope2x: 75,
                                                                                                                                                                                                                                                scope4x: 70,
                                                                                                                                                                                                                                                        scope8x: 60
                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                  };

                                                                                                                                                                                                                                                                      const selectedModel = body.model || 'iphone14';
                                                                                                                                                                                                                                                                          const config = iPhonePresets[selectedModel] || iPhonePresets.iphone14;

                                                                                                                                                                                                                                                                              // Aplicar configurações customizadas se fornecidas
                                                                                                                                                                                                                                                                                  Object.keys(body).forEach(key => {
                                                                                                                                                                                                                                                                                        if (key !== 'model' && config.hasOwnProperty(key)) {
                                                                                                                                                                                                                                                                                                config[key] = body[key];
                                                                                                                                                                                                                                                                                                      }
                                                                                                                                                                                                                                                                                                          });

                                                                                                                                                                                                                                                                                                              // Simular processamento na nuvem
                                                                                                                                                                                                                                                                                                                  await new Promise(resolve => setTimeout(resolve, 150 + Math.random() * 100));

                                                                                                                                                                                                                                                                                                                      const response = {
                                                                                                                                                                                                                                                                                                                            success: true,
                                                                                                                                                                                                                                                                                                                                  model: config.model,
                                                                                                                                                                                                                                                                                                                                        settings: {
                                                                                                                                                                                                                                                                                                                                                geral: config.geral,
                                                                                                                                                                                                                                                                                                                                                        mira: config.mira,
                                                                                                                                                                                                                                                                                                                                                                redDot: config.redDot,
                                                                                                                                                                                                                                                                                                                                                                        scope2x: config.scope2x,
                                                                                                                                                                                                                                                                                                                                                                                scope4x: config.scope4x,
                                                                                                                                                                                                                                                                                                                                                                                        scope8x: config.scope8x
                                                                                                                                                                                                                                                                                                                                                                                              },
                                                                                                                                                                                                                                                                                                                                                                                                    emulation: {
                                                                                                                                                                                                                                                                                                                                                                                                            iosAcceleration: body.iosAcceleration || true,
                                                                                                                                                                                                                                                                                                                                                                                                                    touchOptimization: true,
                                                                                                                                                                                                                                                                                                                                                                                                                            frameRateBoost: true
                                                                                                                                                                                                                                                                                                                                                                                                                                  },
                                                                                                                                                                                                                                                                                                                                                                                                                                        status: 'Configuração iPhone aplicada',
                                                                                                                                                                                                                                                                                                                                                                                                                                              timestamp: new Date().toISOString(),
                                                                                                                                                                                                                                                                                                                                                                                                                                                    executionTime: Math.round(150 + Math.random() * 100),
                                                                                                                                                                                                                                                                                                                                                                                                                                                          apiVersion: '4.0'
                                                                                                                                                                                                                                                                                                                                                                                                                                                              };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                  return {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        statusCode: 200,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              headers,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    body: JSON.stringify(response)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              return {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    statusCode: 500,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          headers,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                body: JSON.stringify({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        success: false,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                error: 'Erro na configuração iPhone',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        details: error.message
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              })
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    };
}